<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>搭建LNMP环境 | 麦高稻香的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="LNMP代表的就是：Linux系统下Nginx+MySQL+PHP这种网站服务器架构。Linux是一类Unix计算机操作系统的统称，是目前最流行的免费操作系统。代表版本有：debian、centos、ubuntu、fedora、gentoo等。Nginx是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。Mysql是一个小型关系型数据库管理系统。PHP是一种在服">
<meta property="og:type" content="article">
<meta property="og:title" content="搭建LNMP环境">
<meta property="og:url" content="http://github.ouqunfu.com/2017/03/22/搭建LNMP环境.html">
<meta property="og:site_name" content="麦高稻香的博客">
<meta property="og:description" content="LNMP代表的就是：Linux系统下Nginx+MySQL+PHP这种网站服务器架构。Linux是一类Unix计算机操作系统的统称，是目前最流行的免费操作系统。代表版本有：debian、centos、ubuntu、fedora、gentoo等。Nginx是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。Mysql是一个小型关系型数据库管理系统。PHP是一种在服">
<meta property="og:updated_time" content="2017-03-24T09:38:22.753Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="搭建LNMP环境">
<meta name="twitter:description" content="LNMP代表的就是：Linux系统下Nginx+MySQL+PHP这种网站服务器架构。Linux是一类Unix计算机操作系统的统称，是目前最流行的免费操作系统。代表版本有：debian、centos、ubuntu、fedora、gentoo等。Nginx是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。Mysql是一个小型关系型数据库管理系统。PHP是一种在服">
  
    <link rel="alternate" href="/atom.xml" title="麦高稻香的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">麦高稻香的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">专注于Web、PHP、服务器、软件架构</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://github.ouqunfu.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-搭建LNMP环境" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/22/搭建LNMP环境.html" class="article-date">
  <time datetime="2017-03-23T06:40:09.000Z" itemprop="datePublished">2017-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      搭建LNMP环境
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>LNMP代表的就是：Linux系统下Nginx+MySQL+PHP这种网站服务器架构。<br>Linux是一类Unix计算机操作系统的统称，是目前最流行的免费操作系统。代表版本有：debian、centos、ubuntu、fedora、gentoo等。<br>Nginx是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。<br>Mysql是一个小型关系型数据库管理系统。<br>PHP是一种在服务器端执行的嵌入HTML文档的脚本语言。<br>这四种软件均为免费开源软件，组合到一起，成为一个免费、高效、扩展性强的网站服务系统。</p>
<h2 id="1、centos-6-5-X86-64-VMware下编译安装搭建lnmp，架构web环境"><a href="#1、centos-6-5-X86-64-VMware下编译安装搭建lnmp，架构web环境" class="headerlink" title="1、centos 6.5 X86_64 VMware下编译安装搭建lnmp，架构web环境"></a>1、centos 6.5 X86_64 VMware下编译安装搭建lnmp，架构web环境</h2><p>&emsp;建议安装顺序：</p>
<p>&emsp;MySQL——-》》编译PHP—-》》编译nginx</p>
<h3 id="（1）检查编译安装环境"><a href="#（1）检查编译安装环境" class="headerlink" title="（1）检查编译安装环境"></a>（1）检查编译安装环境</h3><h4 id="emsp-查看httpd、mysql、php是否安装"><a href="#emsp-查看httpd、mysql、php是否安装" class="headerlink" title="&emsp;#查看httpd、mysql、php是否安装"></a>&emsp;#查看httpd、mysql、php是否安装</h4><h4 id="emsp-root-localhost-rpm-q-httpd-mysql-php"><a href="#emsp-root-localhost-rpm-q-httpd-mysql-php" class="headerlink" title="&emsp;[root@localhost ~]#rpm -q httpd mysql php"></a>&emsp;[root@localhost ~]#rpm -q httpd mysql php</h4><h4 id="emsp-如果已安装则卸载"><a href="#emsp-如果已安装则卸载" class="headerlink" title="&emsp;#如果已安装则卸载:"></a>&emsp;#如果已安装则卸载:</h4><h4 id="emsp-root-localhost-rpm-e-httpd-–nodeps"><a href="#emsp-root-localhost-rpm-e-httpd-–nodeps" class="headerlink" title="&emsp;[root@localhost ~]#rpm -e httpd –nodeps"></a>&emsp;[root@localhost ~]#rpm -e httpd –nodeps</h4><h4 id="emsp-root-localhost-rpm-e-mysql-–nodeps"><a href="#emsp-root-localhost-rpm-e-mysql-–nodeps" class="headerlink" title="&emsp;[root@localhost ~]#rpm -e mysql –nodeps"></a>&emsp;[root@localhost ~]#rpm -e mysql –nodeps</h4><h4 id="emsp-root-localhost-rpm-e-php-–nodeps"><a href="#emsp-root-localhost-rpm-e-php-–nodeps" class="headerlink" title="&emsp;[root@localhost ~]#rpm -e php –nodeps"></a>&emsp;[root@localhost ~]#rpm -e php –nodeps</h4><h4 id="emsp-删除相关文件"><a href="#emsp-删除相关文件" class="headerlink" title="&emsp;#删除相关文件"></a>&emsp;#删除相关文件</h4><h4 id="emsp-find-name-php-mysql-nginx"><a href="#emsp-find-name-php-mysql-nginx" class="headerlink" title="&emsp;find / -name php mysql nginx"></a>&emsp;find / -name php mysql nginx</h4><h4 id="emsp-rm-rf"><a href="#emsp-rm-rf" class="headerlink" title="&emsp;rm -rf *"></a>&emsp;rm -rf <em>*</em></h4><h3 id="（2）安装解决依赖关系"><a href="#（2）安装解决依赖关系" class="headerlink" title="（2）安装解决依赖关系"></a>（2）安装解决依赖关系</h3><pre><code>yum install -y wget gcc gcc-c++ autoconf libjpeg libjpeg-devel perl perl* perl-CPAN libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers png jpeg autoconf gcc cmake make gcc-c++ gcc ladp ldap* ncurses ncurses-devel zlib zlib-devel zlib-static pcre pcre-devel pcre-static openssl openssl-devel perl libtoolt openldap-devel libxml2-devel ntpdate cmake gd* gd2 ImageMagick-devel jpeg jpeg* pcre-dev* fontconfig libpng libxml2 zip unzip gzip
</code></pre><p>yum install -y wget gcc gcc-c++ autoconf libjpeg libjpeg-devel perl perl* perl-CPAN libpng libpng-devel freetype </p>
<p>freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel </p>
<p>ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl </p>
<p>openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers png jpeg autoconf gcc cmake </p>
<p>make gcc-c++ gcc ladp ldap* ncurses ncurses-devel zlib zlib-devel zlib-static pcre pcre-devel pcre-static </p>
<p>openssl openssl-devel perl libtoolt openldap-devel libxml2-devel ntpdate cmake gd* gd2 ImageMagick-devel jpeg </p>
<p>jpeg<em> pcre-dev</em> fontconfig libpng libxml2 zip unzip gzip</p>
<h3 id="（3）安装mysql-5-5-53"><a href="#（3）安装mysql-5-5-53" class="headerlink" title="（3）安装mysql-5.5.53"></a>（3）安装mysql-5.5.53</h3><p>下载mysql-5.5.53.tar.gz</p>
<p>groupadd mysql</p>
<p>useradd mysql -g mysql</p>
<p>tar -zxvf mysql-5.5.30.tar.gz</p>
<p>cd mysql-5.5.30</p>
<p>cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \</p>
<p>-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \</p>
<p>-DEXTRA_CHARSETS=all \</p>
<p>-DDEFAULT_CHARSET=utf8 \</p>
<p>-DDEFAULT_COLLATION=utf8_general_ci \</p>
<p>-DWITH_EXTRA_CHARSETS:STRING=utf8,gbk \</p>
<p>-DWITH_INNOBASE_STORAGE_ENGINE=1 \</p>
<p>-DWITH_READLINE=1 \</p>
<p>-DENABLED_LOCAL_INFILE=1 \</p>
<p>-DMYSQL_DATADIR=/data/mysql/ \</p>
<p>-DMYSQL_USER=mysql \</p>
<p>-DMYSQL_TCP_PORT=3306    </p>
<pre><code>cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_EXTRA_CHARSETS:STRING=utf8,gbk -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/data/mysql/ -DMYSQL_USER=mysql -DMYSQL_TCP_PORT=3306
</code></pre><p>make &amp;&amp; make install</p>
<p>mkdir -p /data/mysql</p>
<p>chown mysql.mysql -R /data/mysql</p>
<p>mv /etc/my.cnf /etc/my.cnf-old</p>
<p>cp support-files/my-medium.cnf /etc/my.cnf</p>
<p>chmod 755 scripts/mysql_install_db</p>
<p>scripts/mysql_install_db  –user=mysql  –basedir=/usr/local/mysql –datadir=/data/mysql/</p>
<p>cp support-files/mysql.server /etc/init.d/mysqld</p>
<p>chmod 755 /etc/init.d/mysqld</p>
<p>chkconfig mysqld on</p>
<p>service mysqld start</p>
<p>设置mysql的root密码为123456</p>
<p>/usr/local/mysql/bin/mysqladmin -u root password ‘123456’</p>
<h3 id="（4）安装php的扩展库：libiconv"><a href="#（4）安装php的扩展库：libiconv" class="headerlink" title="（4）安装php的扩展库：libiconv"></a>（4）安装php的扩展库：libiconv</h3><p>tar zxvf libiconv-1.13.tar.gz</p>
<p>cd libiconv-1.13/</p>
<p>./configure –prefix=/usr/local</p>
<p>make &amp;&amp; make install</p>
<h3 id="（5）安装php扩展库：libmcrypt"><a href="#（5）安装php扩展库：libmcrypt" class="headerlink" title="（5）安装php扩展库：libmcrypt"></a>（5）安装php扩展库：libmcrypt</h3><p>tar zxvf libmcrypt-2.5.8.tar.gz</p>
<p>cd libmcrypt-2.5.8/</p>
<p>./configure</p>
<p>make &amp;&amp; make install</p>
<p>/sbin/ldconfig</p>
<h4 id="注：这里不要退出去了。"><a href="#注：这里不要退出去了。" class="headerlink" title="注：这里不要退出去了。"></a>注：这里不要退出去了。</h4><p>cd libltdl/</p>
<p>./configure –enable-ltdl-install</p>
<p>make &amp;&amp; make install</p>
<h3 id="（6）-安装php扩展库：mhash"><a href="#（6）-安装php扩展库：mhash" class="headerlink" title="（6） 安装php扩展库：mhash"></a>（6） 安装php扩展库：mhash</h3><p>tar zxvf mhash-0.9.9.9.tar.gz</p>
<p>cd mhash-0.9.9.9/</p>
<p>./configure</p>
<p>make &amp;&amp; make install</p>
<h3 id="（7）-做库的软连接："><a href="#（7）-做库的软连接：" class="headerlink" title="（7） 做库的软连接："></a>（7） 做库的软连接：</h3><p>ln -s /usr/local/lib/libmcrypt.la /usr/lib/libmcrypt.la</p>
<p>ln -s /usr/local/lib/libmcrypt.so /usr/lib/libmcrypt.so</p>
<p>ln -s /usr/local/lib/libmcrypt.so.4 /usr/lib/libmcrypt.so.4</p>
<p>ln -s /usr/local/lib/libmcrypt.so.4.4.8 /usr/lib/libmcrypt.so.4.4.8</p>
<p>ln -s /usr/local/lib/libmhash.a /usr/lib/libmhash.a</p>
<p>ln -s /usr/local/lib/libmhash.la /usr/lib/libmhash.la</p>
<p>ln -s /usr/local/lib/libmhash.so /usr/lib/libmhash.so</p>
<p>ln -s /usr/local/lib/libmhash.so.2 /usr/lib/libmhash.so.2</p>
<p>ln -s /usr/local/lib/libmhash.so.2.0.1 /usr/lib/libmhash.so.2.0.1</p>
<p>ln -s /usr/lib64/libldap* /usr/lib/</p>
<h3 id="8-安装php扩展包：mcrypt"><a href="#8-安装php扩展包：mcrypt" class="headerlink" title="(8) 安装php扩展包：mcrypt"></a>(8) 安装php扩展包：mcrypt</h3><p>tar zxvf mcrypt-2.6.8.tar.gz</p>
<p>cd mcrypt-2.6.8/</p>
<p>/sbin/ldconfig</p>
<p>./configure</p>
<p>make &amp;&amp; make install</p>
<h3 id="9-安装php-5-4-21："><a href="#9-安装php-5-4-21：" class="headerlink" title="(9) 安装php-5.4.21："></a>(9) 安装php-5.4.21：</h3><p>tar -zxvf php-5.4.21.tar.gz</p>
<p>cd php-5.4.21</p>
<p> ./configure –prefix=/usr/local/php –with-config-file-path=/usr/local/php/etc –with-mysql=/usr/local/mysql </p>
<p>–with-mysqli=/usr/local/mysql/bin/mysql_config –with-iconv-dir=/usr/local –with-freetype-dir –with-jpeg-dir </p>
<p>–with-png-dir –with-zlib –with-gd –enable-gd-native-ttf –with-libxml-dir=/usr –enable-xml –disable-rpath </p>
<p>–enable-discard-path –enable-safe-mode –enable-bcmath –enable-shmop –enable-sysvsem –enable-inline-</p>
<p>optimization –with-curl –with-curlwrappers –enable-mbregex –enable-fastcgi –enable-fpm –enable-force-cgi-</p>
<p>redirect –enable-mbstring –with-mcrypt –with-openssl –with-mhash –enable-pcntl –enable-sockets –with-ldap </p>
<p>–with-ldap-sasl –with-xmlrpc –enable-zip –enable-soap –without-pear</p>
<hr>
<p>编译报错：<br>configure: error: Don’t know how to define struct flock on this system, set –enable-opcache=no</p>
<p>解决： 安装 yum groupinstall “Development Tools” </p>
<p>重新编译</p>
<p>configure: WARNING: unrecognized options: –enable-discard-path, –enable-safe-mode, –with-curlwrappers, –enable-fastcgi, –enable-force-cgi-redirect</p>
<p>如果加的参数有不支持的，提示比如：configure: WARNING: unrecognized options: –enable-discard-path, –enable-safe-mode, –enable-fastcgi, –enable-force-cgi-redirect</p>
<p>说明上述这些参数废弃了。</p>
<hr>
<p>ln -s /usr/local/mysql/lib/libmysqlclient.so.18 /usr/lib64/</p>
<p>make ZEND_EXTRA_LIBS=’-liconv’</p>
<p>make install</p>
<p>cp -f php.ini-production /usr/local/php/etc/php.ini</p>
<p>ln -s /usr/local/php/etc/php.ini /usr/local/php/php.ini</p>
<p>cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</p>
<h3 id="10-安装php扩展库：memcache"><a href="#10-安装php扩展库：memcache" class="headerlink" title="(10) 安装php扩展库：memcache"></a>(10) 安装php扩展库：memcache</h3><p>tar zxvf memcache-2.2.5.tgz</p>
<p>cd memcache-2.2.5/</p>
<p>/usr/local/php/bin/phpize</p>
<p>./configure –with-php-config=/usr/local/php/bin/php-config</p>
<p>make &amp;&amp; make install</p>
<h3 id="11-安装php加速：eaccelerator"><a href="#11-安装php加速：eaccelerator" class="headerlink" title="(11) 安装php加速：eaccelerator"></a>(11) 安装php加速：eaccelerator</h3><p>tar -zxvf eaccelerator-eaccelerator-42067ac.tar.gz</p>
<p>cd eaccelerator-eaccelerator-42067ac</p>
<p>/usr/local/php/bin/phpize</p>
<p>./configure –enable-eaccelerator=shared –with-php-config=/usr/local/php/bin/php-config</p>
<p>make &amp;&amp; make install</p>
<p>注：这里安装使用的是php5.6，eaccelerator并不兼容，则略过不安装</p>
<h3 id="（12）-修改php-ini增加memcache-ea等软件信息"><a href="#（12）-修改php-ini增加memcache-ea等软件信息" class="headerlink" title="（12） 修改php.ini增加memcache,ea等软件信息"></a>（12） 修改php.ini增加memcache,ea等软件信息</h3><p>添加memcache库的位置：</p>
<p>vim /usr/local/php/php.ini</p>
<p>;extension_dir = “/usr/local/php/lib/php/extensions/no-debug-non-zts-20100525”<br>(该目录下为安装的扩展.so文件,单个加载.so，否则pdo模板无法加载)</p>
<p>extension = “memcache.so”</p>
<p>extension = “pdo_mysql.so”</p>
<p>extension = “imagick.so”</p>
<h3 id="（13）安装php扩展库-PDO-MYSQL"><a href="#（13）安装php扩展库-PDO-MYSQL" class="headerlink" title="（13）安装php扩展库:PDO_MYSQL"></a>（13）安装php扩展库:PDO_MYSQL</h3><p>tar zxvf PDO_MYSQL-1.0.2.tgz</p>
<p>cd PDO_MYSQL-1.0.2/</p>
<p>/usr/local/php/bin/phpize</p>
<p>./configure –with-php-config=/usr/local/php/bin/php-config –with-pdo-mysql=/usr/local/mysql</p>
<p>ln -s /usr/local/mysql/include/* /usr/local/include/</p>
<p>make &amp;&amp; make install</p>
<h3 id="（14）安装ImageMagick服务"><a href="#（14）安装ImageMagick服务" class="headerlink" title="（14）安装ImageMagick服务"></a>（14）安装ImageMagick服务</h3><p>tar zxvf ImageMagick.tar.gz</p>
<p>cd ImageMagick-6.5.1-2/</p>
<p>./configure &amp;&amp; make &amp;&amp; make install</p>
<h3 id="（15）安装php扩展库：imagick"><a href="#（15）安装php扩展库：imagick" class="headerlink" title="（15）安装php扩展库：imagick"></a>（15）安装php扩展库：imagick</h3><p>tar zxvf imagick-3.1.2.tgz</p>
<p>cd imagick-3.1.2/</p>
<p>/usr/local/php/bin/phpize</p>
<p>ln -s /usr/local/include/ImageMagick-6 /usr/local/include/ImageMagick</p>
<p>./configure –with-php-config=/usr/local/php/bin/php-config</p>
<p>make &amp;&amp; make install</p>
<h3 id="（16）添加WWW用户，为系统运行nginx专用用户："><a href="#（16）添加WWW用户，为系统运行nginx专用用户：" class="headerlink" title="（16）添加WWW用户，为系统运行nginx专用用户："></a>（16）添加WWW用户，为系统运行nginx专用用户：</h3><p>/usr/sbin/groupadd www</p>
<p>/usr/sbin/useradd -g www www</p>
<p>mkdir -p /var/log/nginx</p>
<p>chmod +w /var/log/nginx</p>
<p>chown -R www:www /var/log/nginx</p>
<p>mkdir -p /data0/www</p>
<p>chmod +w /data0/www</p>
<p>chown -R www:www /data0/www</p>
<h3 id="（17）修改php-fpm-conf的配置："><a href="#（17）修改php-fpm-conf的配置：" class="headerlink" title="（17）修改php-fpm.conf的配置："></a>（17）修改php-fpm.conf的配置：</h3><p>vim /usr/local/php/etc/php-fpm.conf</p>
<h4 id="去掉-更改-配置文件中的"><a href="#去掉-更改-配置文件中的" class="headerlink" title="去掉/更改 配置文件中的;"></a>去掉/更改 配置文件中的;</h4><p>pm.max_children = 64</p>
<p>pm.start_servers = 20</p>
<p>pm.min_spare_servers = 5</p>
<p>pm.max_spare_servers = 35</p>
<p>pm.max_requests = 1024</p>
<p>user = www</p>
<p>group = www</p>
<h4 id="检查语法是否正确"><a href="#检查语法是否正确" class="headerlink" title="检查语法是否正确"></a>检查语法是否正确</h4><p>/usr/local/php/sbin/php-fpm -t</p>
<p>NOTICE: configuration file /usr/local/php/etc/php-fpm.conf test is successful</p>
<p>看到上面的信息 证明php配置文件正常，可以启动了。</p>
<h3 id="（18）-添加环境变量："><a href="#（18）-添加环境变量：" class="headerlink" title="（18） 添加环境变量："></a>（18） 添加环境变量：</h3><p>echo “export PATH=\$PATH:/usr/local/php/sbin/“ &gt;&gt;/etc/profile</p>
<p>echo “export PATH=\$PATH:/usr/local/php/bin/“ &gt;&gt;/etc/profile</p>
<p>. /etc/profile</p>
<pre><code>注意：这里最后一步报错-bash: ./etc/profile: Permission denied

原因是指令 . /etc/profile 点和斜杠之间应该是有空格的，这里漏掉了
</code></pre><h3 id="（19）安装nginx的-pcre"><a href="#（19）安装nginx的-pcre" class="headerlink" title="（19）安装nginx的 pcre"></a>（19）安装nginx的 pcre</h3><p>卸载PCRE</p>
<p>rpm -qa pcre</p>
<p>rpm -e –nodeps pcre</p>
<p>tar -zxvf pcre2-10.20.tar.gz</p>
<p>cd pcre2-10.20 &amp;&amp; ./configure –prefix=/usr/local/pcre &amp;&amp; make &amp;&amp; make install</p>
<pre><code>注意：此处configure出错
grep: error while loading shared libraries: libpcre.so.0: cannot open shared object file: No such file or directory
原因是libpcre.so.0文件没有了

解决方法：

改用yum源安装 yum install pcre
</code></pre><h3 id="（20）编译安装-nginx"><a href="#（20）编译安装-nginx" class="headerlink" title="（20）编译安装 nginx"></a>（20）编译安装 nginx</h3><p>tar -zxvf nginx-1.10.1.tar.gz</p>
<p>cd nginx-1.10.1/</p>
<p>./configure –user=www –group=www –prefix=/usr/local/nginx –sbin-path=/usr/local/nginx/sbin/nginx –conf-</p>
<p>path=/usr/local/nginx/conf/nginx.conf –with-http_stub_status_module –with-http_ssl_module –with-</p>
<p>pcre=/usr/local/pcre –lock-path=/var/run/nginx.lock –pid-path=/var/run/nginx.pid</p>
<p>make &amp;&amp; make install</p>
<pre><code>注意：make 报错
make -f objs/Makefile
make[1]: Entering directory `/home/ferry/www/service-file/nginx-1.10.1&apos;
cd /usr/local/pcre \
    &amp;&amp; if [ -f Makefile ]; then make distclean; fi \
    &amp;&amp; CC=&quot;cc&quot; CFLAGS=&quot;-O2 -fomit-frame-pointer -pipe &quot; \
    ./configure --disable-shared 
/bin/sh: line 2: ./configure: No such file or directory
make[1]: *** [/usr/local/pcre/Makefile] Error 127
make[1]: Leaving directory `/home/ferry/www/service-file/nginx-1.10.1&apos;
make: *** [build] Error 2

解决：--with-pcre=DIR 是指 pcre 的源码目录，而不是 pcre 的安装目录
所以修改--with-pcre=/usr/local/pcre 为 --with-pcre=/home/ferry/www/service-file/pcre2-10.20

再报错
cc: /home/ferry/www/service-file/pcre2-10.20/.libs/libpcre.a: No such file or directory
make[1]: *** [objs/nginx] Error 1
make[1]: Leaving directory `/home/ferry/www/service-file/nginx-1.10.1&apos;
make: *** [build] Error 2

解决方案：

mkdir -p /home/ferry/www/service-file/pcre2-10.20/.libs
cp /usr/lib/libpcre.a /home/ferry/www/service-file/pcre2-10.20/libpcre.a
cp /usr/lib/libpcre.a /home/ferry/www/service-file/pcre2-10.20/libpcre.la
cp /usr/lib/libpcre.a /home/ferry/www/service-file/pcre2-10.20/.libs/libpcre.a
cp /usr/lib/libpcre.a /home/ferry/www/service-file/pcre2-10.20/.libs/libpcre.la
</code></pre><p>编译成功</p>
<h3 id="（21）修改nginx配置文件"><a href="#（21）修改nginx配置文件" class="headerlink" title="（21）修改nginx配置文件"></a>（21）修改nginx配置文件</h3><p>user www;</p>
<p>events {</p>
<p>use epoll;</p>
<p>worker_connections  1024;</p>
<p>}</p>
<pre><code>#注意 把/scripti改为$document_root$  不然就是 file not found                                                     
</code></pre><p>location ~ .php$ {</p>
<p>root           html;</p>
<p>fastcgi_pass   127.0.0.1:9000;</p>
<p>fastcgi_index  index.php;</p>
<p>fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</p>
<p>include        fastcgi_params;</p>
<p>}</p>
<h3 id="（22）写一个php的测试文件：phpinfo"><a href="#（22）写一个php的测试文件：phpinfo" class="headerlink" title="（22）写一个php的测试文件：phpinfo"></a>（22）写一个php的测试文件：phpinfo</h3><p>cat &gt;&gt;/usr/local/nginx/html/index.php&lt;&lt;EOF</p>
<p>&lt;?php             </p>
<p>phpinfo();          </p>
<p>?&gt;            </p>
<p>EOF</p>
<h3 id="（23）添加开机启动"><a href="#（23）添加开机启动" class="headerlink" title="（23）添加开机启动:"></a>（23）添加开机启动:</h3><p>echo “/usr/local/php/sbin/php-fpm” &gt;&gt; /etc/rc.local</p>
<p>echo “/usr/local/nginx/sbin/nginx” &gt;&gt; /etc/rc.local</p>
<p>echo “/etc/init.d/mysqld restart” &gt;&gt; /etc/rc.local</p>
<h3 id="（24）启动nginx-启动php-fpm-开放防火墙iptables-80端口"><a href="#（24）启动nginx-启动php-fpm-开放防火墙iptables-80端口" class="headerlink" title="（24）启动nginx 启动php-fpm 开放防火墙iptables 80端口"></a>（24）启动nginx 启动php-fpm 开放防火墙iptables 80端口</h3><h3 id="（25）浏览器访问："><a href="#（25）浏览器访问：" class="headerlink" title="（25）浏览器访问："></a>（25）浏览器访问：</h3><p><a href="http://ip/index.php" target="_blank" rel="external">http://ip/index.php</a></p>
<h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><h3 id="1-关于-etc-init-d"><a href="#1-关于-etc-init-d" class="headerlink" title="1.关于/etc/init.d"></a>1.关于/etc/init.d</h3><p>/etc/init.d目录包含许多系统各种服务的启动和停止脚本</p>
<h3 id="2-关于-etc-rc-local"><a href="#2-关于-etc-rc-local" class="headerlink" title="2.关于/etc/rc.local"></a>2.关于/etc/rc.local</h3><p>该脚本是在系统初始化级别脚本运行之后再执行的，因此可以安全地在里面添加你想在系统启动之后执行的脚本。</p>
<h3 id="参考链接-1、-centos-6-5-搭建lnmp环境"><a href="#参考链接-1、-centos-6-5-搭建lnmp环境" class="headerlink" title="参考链接 1、 centos 6.5 搭建lnmp环境"></a>参考链接 1、 <a href="http://blog.csdn.net/u010098331/article/details/50749587" target="_blank" rel="external">centos 6.5 搭建lnmp环境</a></h3><p>2 下载所有使用到的软件：（13个）</p>
<p>wget <a href="http://ftp.gnu.org/gnu/libiclsonv/libiconv-1.13.tar.gz" target="_blank" rel="external">http://ftp.gnu.org/gnu/libiclsonv/libiconv-1.13.tar.gz</a></p>
<p>手动下载 <a href="https://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/" target="_blank" rel="external">https://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/</a> </p>
<p>wget <a href="http://jaist.dl.sourceforge.NET/project/mcrypt/MCrypt/2.6.8/mcrypt-2.6.8.tar.gz" target="_blank" rel="external">http://jaist.dl.sourceforge.NET/project/mcrypt/MCrypt/2.6.8/mcrypt-2.6.8.tar.gz</a></p>
<p>wget <a href="http://jaist.dl.sourceforge.Net/project/mhash/mhash/0.9.9.9/mhash-0.9.9.9.tar.gz" target="_blank" rel="external">http://jaist.dl.sourceforge.Net/project/mhash/mhash/0.9.9.9/mhash-0.9.9.9.tar.gz</a></p>
<p>wget <a href="http://vps.googlecode.com/files/memcache-2.2.5.tgz" target="_blank" rel="external">http://vps.googlecode.com/files/memcache-2.2.5.tgz</a></p>
<p>wget <a href="http://vps.googlecode.com/files/PDO_MYSQL-1.0.2.tgz" target="_blank" rel="external">http://vps.googlecode.com/files/PDO_MYSQL-1.0.2.tgz</a></p>
<p>wget <a href="http://pecl.php.net/get/imagick-3.1.2.tgz" target="_blank" rel="external">http://pecl.php.net/get/imagick-3.1.2.tgz</a></p>
<p>wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.21.tar.gz</p>
<p>wget <a href="http://netcologne.dl.sourceforge.net/project/mysql.mirror/MySQL%205.5.30/mysql-5.5.30.tar.gz（链接已失效，改为使用Sohu的镜像源）" target="_blank" rel="external">http://netcologne.dl.sourceforge.net/project/mysql.mirror/MySQL%205.5.30/mysql-5.5.30.tar.gz（链接已失效，改为使用Sohu的镜像源）</a></p>
<p>wget <a href="http://mirror.aarnet.edu.au/pub/imagemagick/ImageMagick-6.9.8-0.tar.gz" target="_blank" rel="external">http://mirror.aarnet.edu.au/pub/imagemagick/ImageMagick-6.9.8-0.tar.gz</a></p>
<p>wget <a href="http://pecl.php.net/get/imagick-3.1.2.tgz" target="_blank" rel="external">http://pecl.php.net/get/imagick-3.1.2.tgz</a></p>
<p>wget <a href="http://us3.php.net/get/php-5.4.21.tar.gz/from/cn2.php.net/mirror" target="_blank" rel="external">http://us3.php.net/get/php-5.4.21.tar.gz/from/cn2.php.net/mirror</a></p>
<p>wget <a href="http://soft.vpser.net/web/eaccelerator/eaccelerator-eaccelerator-42067ac.tar.gz" target="_blank" rel="external">http://soft.vpser.net/web/eaccelerator/eaccelerator-eaccelerator-42067ac.tar.gz</a></p>
<p>wget <a href="http://nginx.org/download/nginx-1.4.0.tar.gz" target="_blank" rel="external">http://nginx.org/download/nginx-1.4.0.tar.gz</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://github.ouqunfu.com/2017/03/22/搭建LNMP环境.html" data-id="cj0nmxct80006kipvx3znw4ed" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/22/使用thinkphp5开发项目.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          使用thinkphp5开发项目
        
      </div>
    </a>
  
  
    <a href="/2017/03/22/搭建Samba服务.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">搭建Samba服务</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/22/Dependent-依赖.html">Dependent-依赖</a>
          </li>
        
          <li>
            <a href="/2017/03/22/Linux下使用Hexo搭建github博客.html">Linux下使用Hexo搭建github博客</a>
          </li>
        
          <li>
            <a href="/2017/03/22/centos下安装编译安装git-2.3.0.html">centos下安装编译安装git-2.3.0</a>
          </li>
        
          <li>
            <a href="/2017/03/22/lnmp下部署thinkphp5项目.html">lnmp下部署thinkphp5项目</a>
          </li>
        
          <li>
            <a href="/2017/03/22/mirrors.html">国内开源镜像mirrors</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 麦高稻香<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>